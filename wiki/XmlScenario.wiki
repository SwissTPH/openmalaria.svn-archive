#summary Editing scenario descriptions

= Introduction =

The main input to the simulator is an [http://www.w3schools.com/xml/default.asp XML] file traditionally called `scenario.xml` (though it may be named something different if the `--scenario FILE` command-line option is passed to openmalaria). This has many sections, described here. Additionally the file contents are described in a more technical (and probably more complete) way by the [http://www.w3schools.com/schema/default.asp XSD] schema [http://code.google.com/p/openmalaria/source/browse/trunk/model/scenario.xsd file].

== Scope of documentation ==

This documentation is intended to aid individuals editing scenario files, either by hand or with the scenario editor currently under development, by serving as a rough reference manual. It omits several details, which may be covered by the editor, but for use by hand it is recommended to refer to existing scenarios as guides.


= Scenario element =

The primary element in the file is called "scenario" (this encapsulates everything else in the file, except the XML header line).

It has the following attributes:

|| attribute         || data type || purpose                                         ||
|| schemaVersion     || int       || Version of XSD schema to use; should correspond to one of the `scenario_VER.xsd` files in [http://code.google.com/p/openmalaria/source/browse/#svn/trunk/test test] ||
|| analysisNo        || int       ||                                                 ||
|| name              || string    || user-friendly name for the scenario             ||
|| wuID              || int       || BOINC workunit number (automatically set when needed) ||
|| assimMode         || 0 or 1    || removes 3 columns from output.txt for BOINC usage (use 0 for local scenarios) ||

== Demography element ==

Describes the population size and age structure. Most of our scenarios use the same age-structure data from Ifakara, Tanzania. Adjusting the population size is useful, since it has a major impact on run-time and stochasticity of results (1000-100000 individuals are often used in experiments; testing scenarios often use less).

== Monitoring element ==

The `monitoring` element has three main sub-elements: `SurveyOptions`, `surveys` and `ageGroup`.

The `surveys` element has a list of `surveyTime` sub-elements, each with the timestep of a survey, starting from 0, the start of the intervention period (numbers match timesteps at which interventions can be deployed).

The `ageGroup` element contains a list of `group` sub-elements, each of which has an `upperbound` attribute. These (and the `lowerbound` attribute of `ageGroup`) define the age-groups which reports are divided into. The age-group specified in output data is the index within these groups, ordered by age (youngest to oldest), with the first age-group having index `1`.

=== Survey Options ===

This element controls which survey measures are [OutputFiles#measures output]. (Omitting an option has the same effect as listing it with value "false".)

|| id || measure || description ||
||  0 || nHost  ||  Total number of humans ||
||  1 || nInfect  ||  number of infected hosts  ||
|| 2 || nExpectd  ||  expected number of infected hosts ||
|| 3 || nPatent  ||  number of patent hosts ||
|| 4 || sumLogPyrogenThres  ||  Sum of the log of the pyrogen threshold ||
|| 5 || sumlogDens  ||  Sum of the logarithm of the parasite density ||
|| 6 || totalInfs  ||  Total infections ||
|| 7 || nTransmit || Infectiousness of human population to mosquitoes. Number of hosts transmitting to mosquitoes (i.e. sum of proportion of mosquitoes that get infected). Single value, not per age-group. ||
|| 8 || totalPatentInf  ||  Total patent infections ||
|| 10 || sumPyrogenThresh  ||  Sum of the pyrogenic threshold ||
|| 11 || nTreatments1  ||  number of treatments (1st line) ||
|| 12 || nTreatments2  ||  number of treatments (2nd line) ||
|| 13 || nTreatments3  ||  number of treatments (inpatient) ||
|| 14 || nUncomp  ||  number of episodes (uncomplicated) ||
|| 15 || nSevere  ||  number of episodes (severe) ||
|| 16 || nSeq  ||  cases with sequelae ||
|| 17 || nHospitalDeaths  ||  deaths in hospital ||
|| 18 || nIndDeaths  ||  number of deaths (indirect) ||
|| 19 || nDirDeaths  ||  number of deaths (direct) ||
|| 20 || nEPIVaccinations  ||  number of EPI vaccine doses given ||
|| 21 || imr_summary || all cause infant mortality rate (returned as a single number over whole intervention period, instead of from a survey interval) ||
|| 22 || nMassVaccinations  ||  number of Mass / Campaign vaccine doses given ||
|| 23 || nHospitalRecovs  ||  recoveries in hospital ||
|| 24 || nHospitalSeqs  ||  sequelae in hospital ||
|| 25 || nIPTDoses  ||  number of IPT Doses ||
|| 26 || annAvgK   || Annual Average Kappa. Calculated once a year as sum of human infectiousness divided by initial EIR summed over a year. Single value, not per age-group. ||
|| 27 || nNMFever  ||  Number of episodes (non-malaria fever) ||
|| 30 || innoculationsPerAgeGroup || The total number of innoculations per age group, summed over the reporting period. ||
|| 28 || innoculationsPerDayOfYear  ||  Innoculations per human (all ages) per day of year, over the last year. ||
|| 29 || kappaPerDayOfYear  ||  Kappa (human infectiousness) weighted by availability per day-of-year for the last year. ||

Vector model parameters. All are point-time outputs, not averages. The Nv0, Nv, Ov and Sv outputs are per-species; the EIR outputs are single values.

|| id || measure || description ||
|| 31 || Vector_Nv0 || Mosquito emergence rate. ||
|| 32 || Vector_Nv  ||  Mosquito population size ||
|| 33 || Vector_Ov  ||  Number of infected mosquitoes ||
|| 34 || Vector_Sv  ||  Number of infectious mosquitoes ||
|| 35 || Vector_EIR_Input  ||  Input EIR (Expected EIR entered into scenario file) ||
|| 36 || Vector_EIR_Simulated  ||  Simulated EIR (EIR output by the vector model) ||

EventScheduler reporting (additional to above).

|| id || measure || description ||
|| 39 || Clinical_RDTs  ||  Number of Rapid Diagnostic Tests used ||
|| 40 || Clinical_DrugUsage  ||  Quantities of drugs used, per active ingredient abbreviation ||
|| 41 || Clinical_FirstDayDeaths  ||  Direct death on first day of CM (before treatment takes effect) ||
|| 42 || Clinical_HospitalFirstDayDeaths  ||  Direct death on first day of CM (before treatment takes effect); hospital only ||

== Interventions ==

The `interventions` element is organized informally into three sections, first descriptions of interventions (without associating times), second continuous interventions, and third timed interventions.

=== Descriptions ===

Intervention descriptions are, at this time, all direct sub-elements of `interventions` and not some other element.

The `MDADescription` element is only required when using _Mass Drug Administration_ interventions on a one-day timestep. It can then take a `schedule` sub-element describing a treatment dose or schedule taken by individuals covered by the administration campaign. There are currently no adherence/dose size/quality effects varying this; i.e. individuals either are not covered by the campaign and recieve nothing or are and recieve the full schedule.

The `vaccineDescription` element describes vaccination campaigns.

The `iptiDescription` describes _Intermittent Preventative Treatment for Infants_ campaigns.

The `anopheles` element, if used, should be listed for each mosquito sub-species (using the `mosquito` attribute to associate with one of the mosquito species specified in entomological data). Each may contain descriptions for _Insecticide Treated Net_ (`ITNDescription`), _Indoor Residual Spraying_ (`IRSDescription`) and a mosquito repellant (`VADescription` — _Vector Availability_) intervention. Theses have sub-elements describing a parameter as a Weibull decay curve. All three have a `deterrency` parameter; additionally `ITNDescription` has `preprandialKillingEffect` and `postprandialKillingEffect` (chance of killing a mosquito before or after feeding) and `IRSDescription` has `killingEffect` (chance of killing mosquito while resting) parameters.

=== Continuous ===

Interventions with continuous deployment are described by a `continuous` element. This accepts sub-elements `vaccine`, `ITN` and `ipti` (see descriptions above); these may occur more than once. (They must be listed in order of type; that is all `vaccine` elements before any `ITN` elements, etc.)

Each of these has the same type: a `targetAgeYrs` attribute and a `coverage` attribute. Every individual has a chance (equal to `coverage`) of recieving this intervention when they reach age `targetAgeYrs` (needn't be an integer).

=== Timed ===

Timed interventions are usually mass campaigns of some sort. The `timed` element accepts a list of `intervention` sub-elements, each of which describes interventions occuring at a time specified by its `time` attribute. The following interventions may occur (and should be listed in this order within each `intervention`):

|| `changeHS` || Replaces the current health-system description with a new one. Must be a complete description of the health system. ||
|| `changeEIR` || Replaces EIR data with new, daily, data described here. Data must be sufficient to last until the end of the simulation. ||
|| `importedInfectionsPerThousandHosts` || Not an intervention, but deployed the same way: a floating-point number describing the chance each individual recieves an infection (hence number introduced is unlikely to be exactly the number specified) ||
|| `MDA` || Mass drug administration (clears infections directly on 5-day timestep and administers drugs on a 1-day timestep) ||
|| `vaccinate` || Mass vaccination campaign ||
|| `ITN` || Mass ITN-deployment campaign ||
|| `IRS` || Mass house-spraying campaign ||
|| `VectorAvailability` || Mass mosquito-repellent deployment campaign ||
|| `ipti` || Mass IPTi campaign ||
|| `larviciding` || Mosquito emergence-rate reduction intervention. Has an `anopheles` sub-element for each mosquito sub-species, containing the attributes: `mosquito` (name of sub-species), `effectiveness` (proportional reduction in mosquito emergence), `duration` (number of days the intervention is effective for). ||

The `MDA` through to `ipti` interventions above are all mass campaigns. Each has its deployment described by the following attributes: `maxAge` and `minAge` describe the age-range applicable (optional; they default to 100 and 0 respectively), and `coverage` specifies the chance that each individual is covered by the campaign.

== Health system ==

== Entomological data ==

== Drug parameters ==

This describes PK and PD parameters of drugs. In the future initial levels of resistance need to be described (in fact, these are to some extent now, but the schema for entering this data may change). For now, just copy this section from another scenario which describes the desired drugs.

== Model parameters ==

Finally, `scenario` contains a `model` element, grouping some of the data describing the "model" together.

=== Model options ===

The `ModelOptions` sub-element is a list of binary options, in the same format as `SurveyOptions` (except here, bug-fix options default to true if not specified). The available options are:

<placeholder>

(For now, see [http://code.google.com/p/openmalaria/source/browse/trunk/include/util/ModelOptions.hpp ModelOptions.hpp].)

=== clinical ===

The `clinical` element currently simply has a `healthSystemMemory` attribute, describing the number of days within which another clinical episode is considered a second-line case.

=== parameters ===

The `parameters` element describes a list of parameters which are fitted. Usually, one can just copy this section from an _appropriate_ scenario. Varying the length of the timestep or changing several of the model's options will affect the ideal values of these parameters. Ideally we should make a list of all fit parameter sets, together with the conditions under which they are valid, publically available somewhere.

A list of which parameters may be specified can be found here: [http://code.google.com/p/openmalaria/source/browse/trunk/include/inputData.h inputData.h] (the numbers, rather than names, are used to specify each parameter in scenario files).

This element also contains some attributes (here for historical reasons):

 *  `interval` — number of days in a time-step
 *  `iseed` — number to seed random-number-generator with
 *  `delta` — unused
 *  `latentp` — number of timesteps by which blood-stage infection is delayed in descriptive infection model (should apply to other models?)