#summary brief instructions for building openmalaria

= Building OpenMalaria =

This page gives a brief idea of how to compile OpenMalaria. We have (older) longer instructions, but I think most of the time they're not actually required. One alternate set of instructions is [LinuxCompiling here], another is unfortunately on a server which is not publically accessible.

Normally we create a parent directory and put all dependencies and code there:
{{{
cd ~
mkdir malariacontrol
cd malariacontrol
}}}
You can also create a malariacontrol/lib dir and put dependency libraries there. But I recommend you install them (make install) in which case you won't need to do this.

== Dependencies ==

 * [UnixBuildBoinc] [http://packages.debian.org/search?keywords=boinc-dev boinc-dev] (optional; unless you want to deploy a boinc version you don't need this)
 * [UnixBuildXercesC] [http://packages.debian.org/search?keywords=libxerces-c2-dev libxerces-c2-dev]
 * xsd − Install the [http://packages.debian.org/search?keywords=xsdcxx xsdcxx] package or manually install from: http://codesynthesis.com/products/xsd/download.xhtml
 * gsl − Install the [http://packages.debian.org/search?keywords=libgsl0-dev libgsl0-dev] package or manually install

== Compiling ==

First, [http://code.google.com/p/openmalaria/source/checkout check out the repository] and {{{cd}}} to that directory.

It's much neater to build code from a separate directory, so all the generated files are kept out of the way:
{{{
mkdir build
cd build
}}}

Now run cmake, passing the path of the openMalaria directory you checked out:
{{{
cmake-gui ..
# You can use ccmake or just cmake instead of cmake-gui
}}}
cmake-gui and ccmake are interactive; you first *configure*, then optionally change some options, then *configure* again and finally *generate*. Options you may want to change (e.g. to create a version to deploy to as a boinc binary):
|| option || ||
|| CMAKE_BUILD_TYPE || You probably should change this; I'd suggest using RelWithDebInfo. ||
|| BOINC_INTEGRATION || Enables BOINC. Defaults to off. ||
|| STATICALLY_LINK || Try linking everything statically instead of dynamically. Don't use unless you know you want it. ||
|| CMAKE_VERBOSE_MAKEFILE || If you're having trouble building and want to tweak the linker command... ||

Now you should be ready to build:
{{{
make
}}}

=== Other build systems ===

There are some other build files included:
 * automake/autoconf used to be the main build method; this may still work. It is not supported any longer due to the amount of time spent hacking things with it.
  {{{
  mkdir build && cd build
  ../configure
  make test
  }}}
 * I experimented with SCons before using CMake. This should work, but without debug/optimisation, boinc, and full static linking. It was never supported; I only produced a minimally-working SConscript file.
  {{{
  scons
   }}}
 * Visual studio 8 (2005) build files; these may get replaced with CMake generated project files in the future.

== Running the included tests ==

From the build directory, run ctest:
{{{
$ ctest
Start processing tests
Test project /home/gouigoui/workspace/OpenMalaria_readOnly/build
  1/ 13 Testing 1                                Passed
  2/ 13 Testing 2                                Passed
  3/ 13 Testing 3                                Passed
  4/ 13 Testing 4                                Passed
  5/ 13 Testing 5                                Passed
  6/ 13 Testing 6                                Passed
  7/ 13 Testing 9                                Passed
  8/ 13 Testing 11                               Passed
  9/ 13 Testing 12                               Passed
 10/ 13 Testing IPT                              Passed
 11/ 13 Testing VecTest                          Passed
 12/ 13 Testing VecFullTest                      Passed
 13/ 13 Testing unittest                         Passed
100% tests passed, 0 tests failed out of 13
}}}

Alternately, you can use the test/run.sh script directly:
{{{
# (from build folder)
test/run.sh 1 2 3
test/run.sh VecTest -- --checkpoint
}}}